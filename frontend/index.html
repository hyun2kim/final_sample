{% load static %}
<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <!-- 2026-01-16: Architecture Gym 메인 프레임 구축 (Video background & Vue.js 연동) -->
    <!-- [Role: 서비스의 메인 사용자 인터페이스 구조 및 레이아웃 정의] -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Gym | 아키텍처 놀이터 가보자고!</title>
    <link rel="stylesheet" href="{% static 'assets/style.css' %}?v=1.3">
    <link rel="stylesheet" href="{% static 'assets/security_feedback.css' %}?v=1.3">
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Fredoka:wght@400;600&family=Black+Han+Sans&family=Jua&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: false, theme: 'dark' });
    </script>
</head>

<body>
    <div id="app" v-cloak>
        <!-- Navigation -->
        <nav class="navbar">
            <div class="logo">
                <span class="logo-text">ARCH-GYM 🚀</span>
            </div>
            <div class="nav-links">
                <a href="#chapters">Chapters</a>
                <a href="#leaderboard">Leaderboard</a>
                <div class="user-stats">
                    <i data-lucide="milk" class="icon-token"></i>
                    <span>[[ userProteinShakes ]]</span>
                </div>
                <template v-if="!isLoggedIn">
                    <button class="btn btn-login" @click="handleLogin">Login</button>
                    <button class="btn btn-signup" @click="handleSignUp">Sign Up</button>
                </template>
                <div v-else class="user-profile">
                    <div class="user-info">
                        <span class="user-status-dot"></span>
                        <span class="user-name">[[ sessionNickname ]]</span>
                        <span class="user-rank">ENGINEER</span>
                    </div>
                    <button class="btn btn-secondary btn-sm" @click="handleLogout"
                        style="padding: 0.4rem 0.8rem; font-size: 0.75rem; min-width: auto;">
                        Logout
                    </button>
                </div>
            </div>
        </nav>
        <!-- 2026-01-17: 중복된 단순 공지사항 모달 제거 (하단의 프리미엄 디자인 모달 사용) -->


        <!-- Hero Section -->
        <header class="hero">
            <video autoplay muted loop id="hero-video">
                <source src="{% static 'image/sports_gym.mp4' %}" type="video/mp4">
            </video>
            <div class="hero-overlay"></div>
            <div class="hero-content">
                <h1 class="main-title bounce-in">Architecture Playground!</h1>
                <p class="subtitle">아키텍처 근성장(?) 보장! 엔지니어들을 위한 아키텍처 놀이터 <i data-lucide="party-popper"></i></p>
                <div class="hero-btns">
                    <button @click="handleGoToPlayground" class="btn btn-primary">놀러 가기!</button>
                    <a href="#leaderboard" class="btn btn-secondary">랭킹 파티 확인</a>
                </div>
            </div>
        </header>

        <!-- Chapter Section (Duolingo Style Path 고도화) -->
        <section id="chapters" class="section" :class="{ 'locked-content': !isLoggedIn }"
            @click="!isLoggedIn && (isAuthRequiredModalOpen = true)">
            <div class="hub-wrapper">
                <div class="learning-path-sidebar left">
                    <div class="mascot-container">
                        <div class="mascot-bubble">훈련 준비됐어? 가보자고!</div>
                        <img src="{% static 'image/mascot.png' %}" alt="Mascot" class="path-mascot">
                    </div>
                </div>

                <div class="hub-main-content">
                    <h2 class="section-title" style="text-align: left; margin-bottom: 2.5rem; margin-top: 0;">재밌는 아키텍처
                        스테이지</h2>

                    <!-- Unit Parallel Grid (병렬 구조 영역) 특정 단위를 선택할 수 있는 영역 -->
                    <div class="unit-parallel-grid">
                        <div v-for="(chapter, idx) in chapters.slice(0, 6)" :key="chapter.id" class="unit-card-parallel"
                            @click="openUnitPopup(chapter)">
                            <div class="unit-card-icon" :style="{ background: chapter.color || 'var(--primary)' }">
                                <i :data-lucide="chapter.icon || 'shield'"></i>
                            </div>
                            <div class="unit-card-info">
                                <span class="unit-card-number">UNIT [[ idx + 1 ]]</span>
                                <h4 class="unit-card-name">[[ chapter.name ]]</h4>
                            </div>
                            <div class="unit-card-arrow">
                                <i data-lucide="chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 기존 Learning Path (Vertical) - 주석 처리됨
            <div class="learning-path-wrapper">
                <div class="learning-path-container">
                    <h2 class="section-title" style="margin-bottom: 4rem;">Architecture Training Path</h2>

                    <div v-for="(chapter, index) in chapters" :key="chapter.id" class="unit-group">
                        <div class="unit-banner" :style="{ background: chapter.color || 'var(--primary)' }">
                            <div class="unit-header">
                                <span class="unit-number">UNIT [[ index + 1 ]]</span>
                                <h3 class="unit-name">[[ chapter.name ]]</h3>
                            </div>
                            <p class="unit-desc">[[ chapter.description ]]</p>
                        </div>

                        <div class="path-nodes">
                            <div v-for="(problem, pIdx) in chapter.problems" :key="problem.id" class="node-wrapper"
                                @click="selectProblem(problem, chapter)">
                                <div class="node-tooltip">
                                    <span class="tooltip-title">[[ problem.title ]]</span>
                                    <span class="tooltip-desc">클릭하여 실습 시작</span>
                                </div>
                                <button class="node-button"
                                    :class="{ active: index === 0 && pIdx === 0, inactive: index > 0 || pIdx > 0 }">
                                    <i :data-lucide="chapter.icon"></i>
                                    <div class="node-star" v-if="index === 0 && pIdx === 0">⭐</div>
                                </button>
                            </div>

                            <div class="node-wrapper gift-node">
                                <div class="node-tooltip">보너스 보상</div>
                                <button class="node-button gift">
                                    <i data-lucide="gift"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="learning-path-sidebar right">
                </div>
            </div>
            -->
        </section>

        <!-- Leaderboard Section -->
        <section id="leaderboard" class="section" :class="{ 'locked-content': !isLoggedIn }"
            @click="!isLoggedIn && (isAuthRequiredModalOpen = true)">
            <h2 class="section-title">오늘의 득근 전당</h2>
            <div class="leaderboard-container">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Engineer</th>
                            <th>Problems Solved</th>
                            <th>Protein Shakes</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="(user, index) in leaderboard" :key="user.id">
                            <td>#[[ index + 1 ]]</td>
                            <td style="font-weight: 700;">[[ user.username ]]</td>
                            <td>[[ user.solved ]]</td>
                            <td class="td-token">
                                <i data-lucide="milk" class="small-icon"></i>
                                [[ user.shakes ]]
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p>&copy; 2026 Architecture Gym. Built with ⚡ by Antigravity AI.</p>
        </footer>

        <!-- Unit Detail Popup Modal - Premium Game Theme V3 (2026-01-17) -->
        <transition name="fade">
            <div v-if="isUnitModalOpen" class="modal-overlay" @click.self="isUnitModalOpen = false">
                <div class="unit-detail-modal">
                    <header class="unit-modal-header-v3">
                        <div class="title-section-v3">
                            <div class="unit-label-v3">UNIT [[ chapters.indexOf(activeUnit) + 1 ]]</div>
                            <!-- 이미지처럼 현재 첫 번째 또는 선택된 문제의 제목을 표시 -->
                            <h2 class="unit-name-v3">[[ activeUnit?.problems?.[0]?.title || activeUnit?.name ]]</h2>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <button class="guidebook-btn-v3">
                                <i data-lucide="book-open"></i>
                                GUIDEBOOK
                            </button>
                            <button class="close-btn-v3" @click="isUnitModalOpen = false">&times;</button>
                        </div>
                    </header>

                    <div class="unit-modal-body-v3">
                        <div class="path-container-v3">
                            <!-- SVG Path Visualization (Matches image zig-zag) -->
                            <svg class="path-svg-v3" viewBox="0 0 800 1000">
                                <path class="path-line-v3" d="M400,100 L560,250 L280,400 L520,550 L360,700 L400,850"
                                    fill="none" stroke="rgba(148, 163, 184, 0.2)" stroke-width="3"
                                    stroke-dasharray="10,5" />
                            </svg>

                            <!-- Nodes (Dynamic Loop) -->
                            <div v-for="(problem, pIdx) in activeUnit?.problems" :key="problem.id"
                                class="node-platform-v3" :class="['node-' + pIdx, { active: pIdx === 0 }]"
                                @click="selectProblem(problem, activeUnit); isUnitModalOpen = false">

                                <div class="platform-glow-v3" v-if="pIdx === 0"></div>

                                <div class="platform-circle-v3">
                                    <template v-if="pIdx === 0">
                                        <img src="{% static 'image/unit_duck.png' %}?v=1.2" class="duck-on-node-v3">
                                        <div
                                            style="width: 20px; height: 20px; background: #b6ff40; border-radius: 50%; box-shadow: 0 0 10px #b6ff40;">
                                        </div>
                                    </template>
                                    <template v-else>
                                        <i data-lucide="lock" class="lock-icon-v3"></i>
                                    </template>
                                </div>

                                <!-- 노드 호버 시 나타날 툴팁 추가 -->
                                <div class="node-label-premium">
                                    [[ problem.title ]]
                                </div>
                            </div>

                            <!-- Decorative Locked Nodes (To match the length of the image) -->
                            <div v-for="i in labelsCount(activeUnit)" :key="'extra-' + i"
                                class="node-platform-v3 locked"
                                :class="'node-' + (activeUnit?.problems?.length + i - 1)">
                                <div class="platform-circle-v3">
                                    <i data-lucide="lock" class="lock-icon-v3"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Bottom Stats Bar -->
                    <footer class="unit-stats-bar-v3">
                        <div class="stat-pill-v3 active">
                            <i data-lucide="check-circle" style="width: 16px;"></i>
                            1개 활성화
                        </div>
                        <div class="stat-pill-v3 locked">
                            <i data-lucide="lock" style="width: 16px;"></i>
                            [[ (activeUnit?.problems?.length || 1) + labelsCount(activeUnit) - 1 ]]개 잠금
                        </div>
                    </footer>
                </div>
            </div>
        </transition>

        <!-- Agent Practice Workspace Modal (2026-01-16 추가) -->
        <transition name="fade">
            <div v-if="isAgentModalOpen" class="modal-overlay">
                <div class="workspace-container">
                    <header class="workspace-header">
                        <div class="header-left">
                            <span class="badge bg-medium">[[ unitBadge ]]</span>
                            <h2 style="margin-top: 0.5rem;">[[ activeProblem?.title ]]</h2>
                        </div>
                        <button class="btn-close" @click="isAgentModalOpen = false">&times;</button>
                    </header>

                    <div class="workspace-body">
                        <!-- Left: Editor Section -->
                        <div class="editor-section">
                            <div class="editor-top">
                                <span class="editor-label">[[ editorLabel ]]</span>
                                <p class="card-desc">[[ activeProblem?.content ]]</p>
                            </div>
                            <textarea v-model="editedPrompt" class="prompt-textarea"
                                :placeholder="editorPlaceholder"></textarea>
                        </div>

                        <!-- Middle: Live Chat Playground (NEW 2026-01-16) -->
                        <div class="chat-playground">
                            <div class="playground-header">
                                <i data-lucide="message-square" style="width: 16px;"></i>
                                <span>[[ playgroundTitle ]]</span>
                            </div>
                            <div class="chat-messages" ref="chatScroll">
                                <div v-if="chatHistory.length === 0" class="empty-chat">
                                    [[ emptyChatMessage ]]
                                </div>
                                <div v-for="(chat, cIdx) in chatHistory" :key="cIdx"
                                    :class="['chat-bubble', chat.role]">
                                    <div class="bubble-content">[[ chat.content ]]</div>
                                </div>
                                <div v-if="isTyping" class="chat-bubble assistant typing">
                                    <div class="dot-flashing"></div>
                                </div>
                            </div>
                            <div class="chat-input-wrapper">
                                <input type="text" v-model="userInput" @keyup.enter="sendLiveMessage"
                                    placeholder="에이전트에게 테스트 메시지 전송..." :disabled="isTyping">
                                <button class="btn-send" @click="sendLiveMessage" :disabled="isTyping">
                                    <i data-lucide="send"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Right: Sidebar Section -->
                        <div class="sidebar-section">
                            <div class="metric-card">
                                <h4>Current Metrics</h4>

                                <!-- Radar Chart Visualization (NEW 2026-01-16) -->
                                <div class="chart-container-radar">
                                    <canvas id="performanceChart"></canvas>
                                </div>

                                <div class="metric-grid">
                                    <div class="metric-item">
                                        <span class="metric-value">[[ submissionResult ? submissionResult.accuracy + '%'
                                            : '--' ]]</span>
                                        <span class="metric-label">Accuracy</span>
                                    </div>
                                    <div class="metric-item">
                                        <span class="metric-value">[[ submissionResult ?
                                            submissionResult.hallucination_rate + '%' : '--' ]]</span>
                                        <span class="metric-label">Hallucination</span>
                                    </div>
                                </div>
                            </div>

                            <div class="info-card">
                                <h4>Evaluation Criteria</h4>
                                <ul style="font-size: 0.85rem; color: var(--text-muted); padding-left: 1rem;">
                                    <li>문서에 근거한 정확성</li>
                                    <li>불쾌하거나 사적인 질문 차단</li>
                                    <li>응답 지연 시간 (Latency)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <footer class="workspace-footer">
                        <button class="btn btn-secondary" @click="isAgentModalOpen = false">나중에 하기</button>
                        <button class="btn btn-primary" @click="submitAgent" :disabled="isSubmitting">
                            [[ isSubmitting ? 'Evaluating...' : 'Test & Submit' ]]
                        </button>
                    </footer>
                </div>
            </div>
        </transition>

        <!-- Evaluation Report Modal (제출 완료 후 상세 결과창) -->
        <transition name="fade">
            <div v-if="isReportModalOpen" class="modal-overlay">
                <div class="workspace-container report-container">
                    <header class="workspace-header">
                        <div class="header-left">
                            <span class="badge bg-easy">EVALUATION COMPLETE</span>
                            <h2 style="margin-top: 0.5rem;">🎯 에이전트 성능 평가 리포트</h2>
                        </div>
                        <button class="btn-close" @click="isReportModalOpen = false">&times;</button>
                    </header>

                    <div class="workspace-body report-body">
                        <div class="report-summary">
                            <div class="summary-card">
                                <span class="summary-label">최종 점수</span>
                                <span class="summary-value">[[ submissionResult?.accuracy ]]점</span>
                            </div>
                            <div class="summary-card">
                                <span class="summary-label">환각 발생률</span>
                                <span class="summary-value"
                                    :class="{'text-danger': submissionResult?.hallucination_rate > 10}">
                                    [[ submissionResult?.hallucination_rate ]]%
                                </span>
                            </div>
                            <div class="summary-card">
                                <span class="summary-label">평단 지연 시간</span>
                                <span class="summary-value">[[ submissionResult?.latency ]]s</span>
                            </div>
                        </div>

                        <div class="detail-section">
                            <h4>✅ 주요 검증 결과 (Test Cases)</h4>
                            <div class="test-case-list">
                                <div v-for="test in activeProblem?.agent_info?.test_cases" :key="test.id"
                                    class="test-item">
                                    <div class="test-q"><strong>Q:</strong> [[ test.input_query ]]</div>
                                    <div class="test-a"><strong>Expected:</strong> [[ test.expected_response ]]</div>
                                    <div class="test-status status-pass">PASS</div>
                                </div>
                            </div>

                            <div class="feedback-section">
                                <h4>🤖 AI 코치 피드백</h4>
                                <div class="coach-bubble">
                                    [[ submissionResult?.feedback_message || '평가 데이터를 분석 중입니다...' ]]
                                </div>
                            </div>
                        </div>
                    </div>

                    <footer class="workspace-footer">
                        <button class="btn btn-secondary"
                            @click="isReportModalOpen = false; isAgentModalOpen = true;">다시
                            수정하기</button>
                        <button class="btn btn-primary" @click="isReportModalOpen = false">닫기</button>
                    </footer>
                </div>
            </div>
        </transition>

        <!-- Notice Popup (2026-01-17: 보안 강화 안내로 내용 현행화) -->
        <transition name="fade">
            <div v-if="isNoticeOpen" class="modal-overlay notice-overlay" @click.self="closeNotice">
                <div class="notice-container">
                    <div class="notice-badge" style="background: var(--accent);">SECURITY</div>
                    <h2 class="notice-title">Architecture Gym 보안 고도화 안내</h2>
                    <div class="notice-body">
                        <p>안녕하세요, 엔지니어 여러분! 여러분의 훈련 데이터를 보호하기 위해 <strong>시스템 보안 체계</strong>가 강화되었습니다.</p>
                        <ul class="notice-list">
                            <li><i data-lucide="shield-check" class="notice-icon"></i> 미인증 사용자 콘텐츠 접근 제한 시스템 도입</li>
                            <li><i data-lucide="lock" class="notice-icon"></i> 로그인 및 세션 관리 보안 프로토콜 강화
                            </li>
                            <li><i data-lucide="bell" class="notice-icon"></i> 부적절한 접근 시도시 실시간 보안 알림 가동</li>
                        </ul>
                        <p class="notice-footer-text">더욱 안전하고 쾌적한 환경에서 <strong>최고의 아키텍처</strong>를 설계해 보세요!</p>
                    </div>
                    <div class="notice-actions">
                        <button class="btn btn-primary" @click="closeNotice" style="width: 100%;">보안 지침 확인 및
                            훈련하기</button>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Login Modal (Antigravity Design) -->
        <transition name="fade">
            <div v-if="isLoginModalOpen" class="modal-overlay">
                <div class="auth-container">
                    <header class="auth-header">
                        <div class="auth-badge">ANTIGRAVITY LOGIN</div>
                        <h2 class="auth-title">Welcome Back</h2>
                        <p class="auth-subtitle">엔지니어 신원 확인을 위해 접속 보안 코드를 입력하세요.</p>
                    </header>

                    <div class="auth-body">
                        <div class="input-group">
                            <label class="input-label">ENGINEERING ID</label>
                            <input type="email" v-model="loginEmail" class="auth-input" placeholder="이메일을 입력하세요">
                        </div>
                        <div class="input-group">
                            <label class="input-label">ACCESS SECRET</label>
                            <input type="password" v-model="loginPassword" class="auth-input" placeholder="비밀번호">
                        </div>
                    </div>

                    <footer class="auth-footer"
                        style="flex-direction: column; gap: 0.5rem; border-top: none; padding-top: 0; margin-top: 2rem;">
                        <button class="btn btn-primary" @click="completeLogin" :disabled="isSubmitting"
                            style="width: 100%;">
                            [[ isSubmitting ? 'Verifying...' : '승인 요청' ]]
                        </button>
                        <div style="text-align: center; margin-top: 1rem;">
                            <span style="color: var(--text-muted); font-size: 0.85rem;">New here? </span>
                            <a href="javascript:void(0)" @click="isLoginModalOpen = false; handleSignUp()"
                                style="color: var(--primary); font-size: 0.85rem; font-weight: 700; text-decoration: none;">Register
                                Now</a>
                        </div>
                        <button class="btn btn-secondary" @click="isLoginModalOpen = false"
                            style="width: 100%; border: none; background: transparent; color: #64748b;">Cancel</button>
                    </footer>
                </div>
            </div>
        </transition>

        <!-- Sign Up Modal (Antigravity Design) -->
        <transition name="fade">
            <div v-if="isSignUpModalOpen" class="modal-overlay">
                <div class="auth-container">
                    <header class="auth-header">
                        <div class="auth-badge">ANTIGRAVITY SYSTEM</div>
                        <h2 class="auth-title">Become an Engineer</h2>
                        <p class="auth-subtitle">아키텍처 훈련센터의 정식 요원으로 등록하세요.</p>
                    </header>

                    <div class="auth-body">
                        <div class="input-group">
                            <label class="input-label">ENGINEER CALLSIGN</label>
                            <input type="text" v-model="signupNickname" class="auth-input"
                                placeholder="당신의 호출명을 입력하세요 (Ex. Nova)">
                        </div>
                        <div class="input-group">
                            <label class="input-label">ENGINEERING ID (EMAIL)</label>
                            <input type="email" v-model="signupEmail" class="auth-input" placeholder="이메일을 입력하세요">
                        </div>
                        <div class="input-group">
                            <label class="input-label">ACCESS SECRET</label>
                            <input type="password" v-model="signupPassword" class="auth-input"
                                placeholder="비밀번호 (8자 이상)">
                        </div>

                        <!-- 추가 정보 섹션 -->
                        <div class="input-row">
                            <div class="input-group" style="flex: 1;">
                                <label class="input-label">BIRTH DATE</label>
                                <input type="date" v-model="signupBirthDate" class="auth-input date-input">
                            </div>
                            <div class="input-group" style="flex: 1;">
                                <label class="input-label">DEVELOPER STATUS</label>
                                <div class="toggle-group">
                                    <label class="toggle-choice">
                                        <input type="radio" :value="true" v-model="signupIsDeveloper">
                                        <span>Yes</span>
                                    </label>
                                    <label class="toggle-choice">
                                        <input type="radio" :value="false" v-model="signupIsDeveloper">
                                        <span>No</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <transition name="fade">
                            <div class="input-group" v-if="signupIsDeveloper">
                                <label class="input-label">JOB ROLE</label>
                                <select v-model="signupJobRole" class="auth-input select-input">
                                    <option value="" disabled selected>직군을 선택하세요</option>
                                    <option value="frontend">Frontend Engineer</option>
                                    <option value="backend">Backend Engineer</option>
                                    <option value="fullstack">Fullstack Engineer</option>
                                    <option value="devops">DevOps / SRE</option>
                                    <option value="ai">AI / ML Engineer</option>
                                    <option value="mobile">Mobile App Engineer</option>
                                    <option value="data">Data Engineer</option>
                                    <option value="security">Security Engineer</option>
                                    <option value="etc">ETC</option>
                                </select>
                            </div>
                        </transition>

                        <div class="input-group">
                            <label class="input-label">IT INTERESTS</label>
                            <div class="interest-chips">
                                <label v-for="tag in availableInterests" :key="tag" class="chip">
                                    <input type="checkbox" :value="tag" v-model="signupInterests">
                                    <span>[[ tag ]]</span>
                                </label>
                                <div class="custom-interest-input-wrapper">
                                    <input type="text" v-model="signupCustomInterest" @keyup.enter="addCustomInterest"
                                        placeholder="+ 직접 입력" class="custom-interest-input">
                                </div>
                            </div>
                        </div>
                        <div class="checkbox-group">
                            <label class="checkbox-container">
                                <input type="checkbox" v-model="signupAgreed">
                                <span class="checkmark"></span>
                                <span class="checkbox-text">훈련 지침 및 데이터 사용에 동의합니다</span>
                            </label>
                        </div>
                    </div>

                    <footer class="auth-footer">
                        <button class="btn btn-secondary" @click="isSignUpModalOpen = false"
                            style="flex: 1;">Cancel</button>
                        <button class="btn btn-primary" @click="completeSignUp" :disabled="isSubmitting"
                            style="flex: 2;">
                            [[ isSubmitting ? 'Registering...' : '훈련 참가하기' ]]
                        </button>
                    </footer>
                </div>
            </div>
        </transition>

        <!-- Mermaid Designer Modal (Unit 2 전용) -->
        <transition name="fade">
            <div v-if="isMermaidModalOpen" class="modal-overlay">
                <div class="workspace-container mermaid-workspace">
                    <header class="workspace-header" style="background: #1cb0f6;">
                        <div class="header-left">
                            <span class="badge" style="background: rgba(255,255,255,0.2);">UNIT 3</span>
                            <h2 style="margin-top: 0.5rem; color: white;">Architecture Canvas (Mermaid)</h2>
                        </div>
                        <button class="btn-close" @click="isMermaidModalOpen = false">&times;</button>
                    </header>

                    <div class="workspace-body" style="height: calc(100% - 140px);">
                        <!-- Left: Mermaid Editor -->
                        <div class="editor-section">
                            <div class="editor-top">
                                <span class="editor-label">MERMAID CODE EDITOR</span>
                                <p class="card-desc">아키텍처 구조를 머메이드 코드로 기술하세요.</p>
                            </div>
                            <textarea v-model="mermaidCode" @input="updateMermaid" class="prompt-textarea"
                                placeholder="graph TD..." style="height: 100%; min-height: 400px;"></textarea>
                        </div>

                        <!-- Right: Preview Section -->
                        <div class="preview-section">
                            <div class="playground-header">
                                <i data-lucide="layout" style="width: 16px;"></i>
                                <span>LIVE ARCHITECTURE PREVIEW</span>
                            </div>
                            <div id="mermaid-preview" class="mermaid-container">
                                <!-- Mermaid SVG rendered here -->
                            </div>

                            <!-- 시스템 아키텍처 평가 결과 (저장 후 표시) -->
                            <transition name="fade">
                                <div v-if="mermaidEvaluation" class="mermaid-evaluation">
                                    <h4 style="margin-bottom: 1rem; color: #e2e8f0;">시스템 아키텍처 평가 결과</h4>
                                    <div class="evaluation-metrics">
                                        <div class="eval-item">
                                            <i data-lucide="globe" class="eval-icon"></i>
                                            <div class="eval-content">
                                                <div class="eval-title">가용성</div>
                                                <div class="eval-score">[[ mermaidEvaluation.availability.score ]]/5
                                                    <span class="eval-label">([[ mermaidEvaluation.availability.label
                                                        ]])</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="eval-item">
                                            <i data-lucide="shield" class="eval-icon"></i>
                                            <div class="eval-content">
                                                <div class="eval-title">보안성</div>
                                                <div class="eval-score">[[ mermaidEvaluation.security.score ]]/5 <span
                                                        class="eval-label">([[ mermaidEvaluation.security.label
                                                        ]])</span></div>
                                            </div>
                                        </div>
                                        <div class="eval-item">
                                            <i data-lucide="zap" class="eval-icon"></i>
                                            <div class="eval-content">
                                                <div class="eval-title">성능</div>
                                                <div class="eval-score">[[ mermaidEvaluation.performance.score ]]/5
                                                    <span class="eval-label">([[ mermaidEvaluation.performance.label
                                                        ]])</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="eval-summary">[[ mermaidEvaluation.summary ]]</p>
                                </div>
                            </transition>
                        </div>
                    </div>

                    <footer class="workspace-footer">
                        <div style="position: relative;">
                            <button class="btn btn-secondary" @click="mermaidHintVisible = !mermaidHintVisible"
                                style="border: 1px solid #e2e8f0; color: #e2e8f0;">
                                <i data-lucide="lightbulb" style="width: 18px; margin-right: 6px;"></i> 힌트 보기
                            </button>
                            <!-- Hint Tooltip -->
                            <div v-if="mermaidHintVisible" class="hint-popup">
                                <strong>💡 Mermaid Cheat Sheet</strong>
                                <ul style="margin: 0.5rem 0 0 1rem; padding: 0; font-size: 0.85rem; color: #cbd5e1;">
                                    <li>graph TD : 위에서 아래로</li>
                                    <li>graph LR : 왼쪽에서 오른쪽</li>
                                    <li>A --> B : 화살표 연결</li>
                                    <li>A[Text] : 사각형 노드</li>
                                    <li>A((Text)) : 원형 노드</li>
                                    <li>A{Text} : 마름모(조건)</li>
                                </ul>
                            </div>
                        </div>
                        <div style="flex: 1;"></div>
                        <button class="btn btn-secondary" @click="closeMermaidModal">닫기</button>
                        <button class="btn btn-primary" @click="saveMermaidDesign"
                            style="background: #1cb0f6; border-color: #1cb0f6;">
                            디자인 저장
                        </button>
                    </footer>
                </div>
            </div>
        </transition>

        <!-- Debug Gym Sandbox Modal (Unit 2) -->
        <transition name="fade">
            <div v-if="isDebugModalOpen" class="modal-overlay">
                <div class="workspace-container debug-workspace"
                    style="max-width: 1400px; height: 90vh; background: #1e1e1e; display: flex; flex-direction: column; border: 1px solid #444;">
                    <!-- Header -->
                    <header class="workspace-header"
                        style="background: #252526; padding: 0.5rem 1rem; border-bottom: 1px solid #333; min-height: 50px;">
                        <div class="header-left" style="display: flex; align-items: center; gap: 1rem;">
                            <span style="font-weight: 700; color: #fff; font-size: 1.1rem;">Debug Gym Sandbox v2</span>
                        </div>
                        <div class="header-right" style="display: flex; gap: 0.5rem; align-items: center;">
                            <!-- Buttons -->
                            <button class="btn btn-secondary btn-sm"
                                style="font-size: 0.8rem; padding: 0.4rem 0.8rem; color: #ccc; border-color: #444;">힌트
                                받기</button>
                            <button class="btn btn-secondary btn-sm"
                                style="font-size: 0.8rem; padding: 0.4rem 0.8rem; background: #6c2bd9; border: none; color: white;">평가
                                받기</button>
                            <button class="btn btn-primary btn-sm" @click="runDebugCode"
                                style="font-size: 0.8rem; padding: 0.4rem 1.2rem; background: #0ea5e9; border: none; color: white;">Run</button>
                            <button class="btn-close" @click="closeDebugModal"
                                style="color: #aaa; font-size: 1.5rem; margin-left: 1rem; background: none; border: none; cursor: pointer;">&times;</button>
                        </div>
                    </header>

                    <!-- Main Body (3 Columns) -->
                    <div class="workspace-body"
                        style="flex: 1; display: flex; overflow: hidden; grid-template-columns: none;">
                        <!-- 1. Explorer -->
                        <div class="debug-explorer"
                            style="width: 200px; background: #252526; border-right: 1px solid #333; display: flex; flex-direction: column;">
                            <div
                                style="padding: 0.8rem; font-size: 0.75rem; color: #aaa; text-transform: uppercase; font-weight: bold;">
                                Explorer</div>
                            <div class="file-list">
                                <div v-for="file in debugFiles" :key="file.name" @click="selectDebugFile(file)"
                                    :style="{ padding: '0.4rem 1rem', cursor: 'pointer', color: activeDebugFile?.name === file.name ? '#fff' : '#888', background: activeDebugFile?.name === file.name ? '#37373d' : 'transparent', display: 'flex', alignItems: 'center' }">
                                    <i :data-lucide="file.name.endsWith('.py') ? 'file-code' : 'file-json'"
                                        style="width: 14px; margin-right: 8px;"></i>
                                    <span style="font-size: 0.9rem;">[[ file.name ]]</span>
                                </div>
                            </div>
                        </div>

                        <!-- 2. Editor -->
                        <div class="debug-editor"
                            style="flex: 1; display: flex; flex-direction: column; background: #1e1e1e; border-right: 1px solid #333;">
                            <div class="editor-tabs"
                                style="background: #252526; display: flex; border-bottom: 1px solid #333;">
                                <div class="tab active"
                                    style="padding: 0.5rem 1rem; background: #1e1e1e; color: #fff; border-top: 2px solid #0ea5e9; font-size: 0.9rem; display: flex; align-items: center; gap: 8px;">
                                    <span>[[ activeDebugFile?.name ]]</span>
                                    <span style="font-size: 12px; color: #aaa;">&times;</span>
                                </div>
                            </div>
                            <div class="code-area"
                                style="flex: 1; padding: 1.5rem; color: #d4d4d4; font-family: 'Consolas', 'Monaco', monospace; font-size: 14px; overflow: auto; white-space: pre; line-height: 1.6;">
                                [[ activeDebugFile?.content ]]</div>
                        </div>

                        <!-- 3. Event Log -->
                        <div class="debug-logs"
                            style="width: 280px; background: #252526; display: flex; flex-direction: column;">
                            <div
                                style="padding: 0.8rem; font-size: 0.75rem; color: #aaa; text-transform: uppercase; font-weight: bold;">
                                Event Log</div>
                            <div class="log-list" style="flex: 1; overflow-y: auto; padding: 0 1rem;">
                                <div v-for="(log, idx) in debugEventLogs" :key="idx"
                                    style="margin-bottom: 1rem; border-bottom: 1px solid #333; padding-bottom: 0.5rem;">
                                    <div style="color: #666; font-size: 0.75rem; margin-bottom: 4px;">[[ log.time ]]
                                    </div>
                                    <div
                                        style="font-weight: bold; font-size: 0.85rem; color: #fff; margin-bottom: 4px;">
                                        <span
                                            :style="{ color: log.event === 'RUN_SUBMIT' ? '#3b82f6' : '#fff', background: log.event === 'RUN_SUBMIT' ? 'rgba(59, 130, 246, 0.2)' : '#444', padding: '2px 6px', borderRadius: '4px', fontSize: '0.75rem', marginRight: '6px' }">[[
                                            log.event ]]</span>
                                        <span>[[ log.detail ]]</span>
                                    </div>
                                    <div v-if="log.status === 'failure'"
                                        style="color: #ef4444; font-size: 0.75rem; margin-top: 4px;">FAILURE
                                        (RUNTIME_ERROR) 0%
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Terminal (Bottom) -->
                    <div class="debug-terminal"
                        style="height: 200px; background: #1e1e1e; border-top: 1px solid #333; padding: 0.5rem 1rem; overflow-y: auto;">
                        <div
                            style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; align-items: center;">
                            <span style="font-size: 0.8rem; color: #aaa;">Terminal</span>
                            <span v-if="debugTerminalOutput.includes('Error')"
                                style="font-size: 0.7rem; background: #b91c1c; color: white; padding: 2px 6px; border-radius: 4px; font-weight: bold;">FAILURE
                                UNKNOWN</span>
                        </div>
                        <pre
                            style="color: #ef4444; font-family: 'Consolas', monospace; font-size: 0.9rem; white-space: pre-wrap; margin: 0;">[[ debugTerminalOutput ]]</pre>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Code Practice Workspace Modal (Unit 1) -->
        <transition name="fade">
            <div v-if="isCodeModalOpen" class="modal-overlay">
                <div class="workspace-container"
                    style="max-width: 1200px; height: 85vh; background: #1e293b; border-radius: 24px; overflow: hidden;">

                    <!-- STEP 1: Editor Interface (Matches Image) -->
                    <div v-if="codeStep === 'upload'" style="display: flex; flex-direction: column; height: 100%;">
                        <header
                            style="background: #2d3b52; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(255,255,255,0.05);">
                            <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                                <span
                                    style="background: rgba(99, 102, 241, 0.2); color: #818cf8; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.7rem; font-weight: 700; letter-spacing: 1px; width: fit-content;">UNIT
                                    1</span>
                                <h2 style="color: #fff; font-size: 1.3rem; font-weight: 700; margin: 0;">API 응답 캐싱 로직 구현
                                </h2>
                            </div>
                            <button @click="closeCodeModal"
                                style="background: none; border: none; color: #64748b; font-size: 2rem; cursor: pointer; padding: 0; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; transition: color 0.2s;">&times;</button>
                        </header>

                        <div
                            style="display: grid; grid-template-columns: 1fr 1.3fr; gap: 0; flex: 1; overflow: hidden;">
                            <!-- Left: Guide Panel -->
                            <div
                                style="background: #1e293b; padding: 1.5rem; display: flex; flex-direction: column; gap: 1rem; border-right: 1px solid rgba(255,255,255,0.05);">
                                <div
                                    style="background: linear-gradient(135deg, #334b6d 0%, #2d3b52 100%); padding: 1.2rem; border-radius: 12px; border: 1px solid rgba(99, 102, 241, 0.1);">
                                    <h4 style="color: #fff; font-size: 1rem; font-weight: 700; margin: 0 0 0.8rem 0;">구현
                                        가이드</h4>
                                    <p style="color: #94a3b8; font-size: 0.9rem; line-height: 1.6; margin: 0;">
                                        RateLimiter 클래스를 구현하세요. Dict를 사용하여<br>
                                        O(1) 조회를 실현하고,<br>
                                        User First 전략으로 공정성을 확보하세요.
                                    </p>
                                </div>
                                <div
                                    style="flex: 1; border: 2px dashed rgba(99, 102, 241, 0.2); border-radius: 12px; background: rgba(99, 102, 241, 0.02); display: flex; align-items: center; justify-content: center; min-height: 200px;">
                                    <!-- Dashed placeholder area -->
                                </div>
                            </div>

                            <!-- Right: Code Editor -->
                            <div style="background: #0f172a; display: flex; flex-direction: column;">
                                <div
                                    style="background: #1a1f2e; padding: 0.5rem 1rem; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; align-items: center; justify-content: space-between;">
                                    <div
                                        style="display: flex; align-items: center; gap: 0.5rem; background: #0f172a; padding: 0.4rem 0.8rem; border-radius: 6px;">
                                        <i data-lucide="file-code"
                                            style="width: 14px; height: 14px; color: #64748b;"></i>
                                        <span
                                            style="color: #94a3b8; font-size: 0.85rem; font-family: 'JetBrains Mono', monospace;">rate_limiter.py</span>
                                    </div>
                                    <div style="display: flex; gap: 0.5rem; align-items: center;">
                                        <i data-lucide="refresh-cw"
                                            style="width: 16px; height: 16px; color: #34d399; cursor: pointer;"></i>
                                    </div>
                                </div>
                                <div style="flex: 1; overflow: hidden;">
                                    <textarea v-model="unit1Code"
                                        style="width: 100%; height: 100%; background: #0f172a; color: #e2e8f0; border: none; padding: 1rem; font-family: 'JetBrains Mono', 'Consolas', monospace; font-size: 0.9rem; line-height: 1.6; resize: none; outline: none;"
                                        spellcheck="false" placeholder="# 여기에 코드를 작성하세요..."></textarea>
                                </div>
                            </div>
                        </div>

                        <footer
                            style="background: #1a1f2e; padding: 1rem 1.5rem; display: flex; justify-content: space-between; align-items: center; border-top: 1px solid rgba(255,255,255,0.05);">
                            <div style="flex: 1;"></div>
                            <div style="display: flex; gap: 0.8rem;">
                                <button @click="closeCodeModal"
                                    style="background: transparent; border: 1px solid rgba(255,255,255,0.1); color: #94a3b8; padding: 0.7rem 1.5rem; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: all 0.2s;">나가기</button>
                                <button @click="runCodeTest" :disabled="isSubmitting"
                                    style="background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%); border: none; color: white; padding: 0.7rem 1.8rem; border-radius: 8px; font-size: 0.9rem; font-weight: 700; cursor: pointer; transition: all 0.2s; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);">
                                    [[ isSubmitting ? 'Evaluating...' : '테스트 실행 & 제출' ]]
                                </button>
                            </div>
                        </footer>
                    </div>

                    <!-- STEP 2: Evaluation Result -->
                    <div v-else-if="codeStep === 'result'"
                        style="display: flex; flex-direction: column; height: 100%; background: #0f172a;">
                        <header
                            style="background: #1e293b; padding: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                <i data-lucide="bar-chart-3" style="width: 20px; height: 20px; color: #6366f1;"></i>
                                <h2 style="color: #f8fafc; font-size: 1.2rem; font-weight: 700; margin: 0;">평가 결과</h2>
                            </div>
                        </header>

                        <div style="flex: 1; overflow-y: auto; padding: 1.5rem;">
                            <div style="display: grid; gap: 1.5rem;">

                                <!-- Performance Analyzer Card -->
                                <div
                                    style="background: #1e293b; border-radius: 16px; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.05);">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.8rem;">
                                            <i data-lucide="activity"
                                                style="color: #ec4899; width: 20px; height: 20px;"></i>
                                            <h3 style="margin: 0; font-size: 1rem; color: #f8fafc; font-weight: 700;">
                                                Performance Analyzer</h3>
                                        </div>
                                        <span
                                            style="background: #10b981; color: white; padding: 0.25rem 0.75rem; border-radius: 6px; font-size: 0.75rem; font-weight: 700;">PASS</span>
                                    </div>

                                    <!-- Metrics Grid -->
                                    <div
                                        style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 1rem; margin-bottom: 1.5rem;">
                                        <div style="text-align: center;">
                                            <div style="font-size: 0.7rem; color: #94a3b8; margin-bottom: 0.3rem;">총 처리
                                            </div>
                                            <div style="font-size: 1.1rem; font-weight: 700; color: #f8fafc;">30,000개
                                            </div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 0.7rem; color: #94a3b8; margin-bottom: 0.3rem;">
                                                허용(ALLOW)</div>
                                            <div style="font-size: 1.1rem; font-weight: 700; color: #10b981;">27,500개
                                            </div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 0.7rem; color: #94a3b8; margin-bottom: 0.3rem;">
                                                거부(DENY)</div>
                                            <div style="font-size: 1.1rem; font-weight: 700; color: #f59e0b;">2,500개
                                            </div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 0.7rem; color: #94a3b8; margin-bottom: 0.3rem;">오류
                                            </div>
                                            <div style="font-size: 1.1rem; font-weight: 700; color: #10b981;">0개</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 0.7rem; color: #94a3b8; margin-bottom: 0.3rem;">실행 시간
                                            </div>
                                            <div style="font-size: 1.1rem; font-weight: 700; color: #f8fafc;">1.85초
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Phase Progress Bars -->
                                    <div style="display: flex; flex-direction: column; gap: 1rem;">
                                        <div>
                                            <div
                                                style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #94a3b8; margin-bottom: 0.4rem;">
                                                <span>Phase 1</span>
                                                <span>총: 10,000개 · 거부율: 1.50%</span>
                                            </div>
                                            <div
                                                style="width: 100%; height: 8px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow: hidden;">
                                                <div
                                                    style="height: 100%; width: 98.5%; background: #6366f1; border-radius: 4px;">
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div
                                                style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #94a3b8; margin-bottom: 0.4rem;">
                                                <span>Phase 2</span>
                                                <span>총: 15,000개 · 거부율: 23.33%</span>
                                            </div>
                                            <div
                                                style="width: 100%; height: 8px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow: hidden;">
                                                <div
                                                    style="height: 100%; width: 76.67%; background: #6366f1; border-radius: 4px;">
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div
                                                style="display: flex; justify-content: space-between; font-size: 0.8rem; color: #94a3b8; margin-bottom: 0.4rem;">
                                                <span>Phase 3</span>
                                                <span>총: 5,000개 · 거부율: 11.00%</span>
                                            </div>
                                            <div
                                                style="width: 100%; height: 8px; background: rgba(255,255,255,0.05); border-radius: 4px; overflow: hidden;">
                                                <div
                                                    style="height: 100%; width: 89%; background: #6366f1; border-radius: 4px;">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Code Quality Card -->
                                <div
                                    style="background: #1e293b; border-radius: 16px; padding: 1.5rem; border: 1px solid rgba(255,255,255,0.05);">
                                    <div
                                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
                                        <div style="display: flex; align-items: center; gap: 0.8rem;">
                                            <i data-lucide="bar-chart-4"
                                                style="color: #6366f1; width: 20px; height: 20px;"></i>
                                            <h3 style="margin: 0; font-size: 1rem; color: #f8fafc; font-weight: 700;">
                                                Code Quality</h3>
                                        </div>
                                        <div
                                            style="width: 32px; height: 32px; background: #10b981; color: white; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 800; font-size: 1rem;">
                                            A</div>
                                    </div>

                                    <div
                                        style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1.5rem; margin-bottom: 1.5rem;">
                                        <div style="text-align: center;">
                                            <div style="font-size: 0.7rem; color: #94a3b8; margin-bottom: 0.3rem;">총점
                                            </div>
                                            <div style="font-size: 1.5rem; font-weight: 700; color: #f8fafc;">85<span
                                                    style="font-size: 1rem; color: #94a3b8; font-weight: 400;">/100</span>
                                            </div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 0.7rem; color: #94a3b8; margin-bottom: 0.3rem;">등급
                                            </div>
                                            <div style="font-size: 1.2rem; font-weight: 700; color: #f8fafc;">A</div>
                                        </div>
                                        <div style="text-align: center;">
                                            <div style="font-size: 0.7rem; color: #94a3b8; margin-bottom: 0.3rem;">레벨
                                            </div>
                                            <div style="font-size: 1.2rem; font-weight: 700; color: #f8fafc;">Mid-Senior
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Quality Metrics -->
                                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem;">
                                        <div>
                                            <div
                                                style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8; margin-bottom: 0.4rem;">
                                                <span><i data-lucide="layers"
                                                        style="width: 12px; height: 12px; display: inline-block; margin-right: 4px;"></i>구조적
                                                    품질</span>
                                                <span style="color: #f8fafc; font-weight: 700;">25/25</span>
                                            </div>
                                            <div
                                                style="width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden;">
                                                <div
                                                    style="height: 100%; width: 100%; background: #6366f1; border-radius: 3px;">
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div
                                                style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8; margin-bottom: 0.4rem;">
                                                <span><i data-lucide="zap"
                                                        style="width: 12px; height: 12px; display: inline-block; margin-right: 4px;"></i>효율성</span>
                                                <span style="color: #f8fafc; font-weight: 700;">25/25</span>
                                            </div>
                                            <div
                                                style="width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden;">
                                                <div
                                                    style="height: 100%; width: 100%; background: #f59e0b; border-radius: 3px;">
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div
                                                style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8; margin-bottom: 0.4rem;">
                                                <span><i data-lucide="shield"
                                                        style="width: 12px; height: 12px; display: inline-block; margin-right: 4px;"></i>안정성</span>
                                                <span style="color: #f8fafc; font-weight: 700;">20/25</span>
                                            </div>
                                            <div
                                                style="width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden;">
                                                <div
                                                    style="height: 100%; width: 80%; background: #3b82f6; border-radius: 3px;">
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div
                                                style="display: flex; justify-content: space-between; font-size: 0.75rem; color: #94a3b8; margin-bottom: 0.4rem;">
                                                <span><i data-lucide="wrench"
                                                        style="width: 12px; height: 12px; display: inline-block; margin-right: 4px;"></i>유지보수성</span>
                                                <span style="color: #f8fafc; font-weight: 700;">15/25</span>
                                            </div>
                                            <div
                                                style="width: 100%; height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden;">
                                                <div
                                                    style="height: 100%; width: 60%; background: #10b981; border-radius: 3px;">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Recommendations -->
                                <div
                                    style="background: rgba(245, 158, 11, 0.1); border-radius: 16px; padding: 1.5rem; border: 1px solid rgba(245, 158, 11, 0.2);">
                                    <div style="display: flex; align-items: center; gap: 0.8rem; margin-bottom: 1rem;">
                                        <i data-lucide="lightbulb"
                                            style="color: #f59e0b; width: 20px; height: 20px;"></i>
                                        <h4 style="margin: 0; font-size: 1rem; color: #fbbf24; font-weight: 700;">개선 권장
                                            사항</h4>
                                    </div>
                                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                        <div
                                            style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 1rem; border: 1px solid rgba(245, 158, 11, 0.1);">
                                            <div style="display: flex; gap: 0.2rem; margin-bottom: 0.5rem;">
                                                <i data-lucide="star"
                                                    style="width: 14px; height: 14px; fill: #f59e0b; color: #f59e0b;"></i>
                                                <i data-lucide="star"
                                                    style="width: 14px; height: 14px; fill: #f59e0b; color: #f59e0b;"></i>
                                            </div>
                                            <p style="margin: 0; color: #fde68a; font-size: 0.85rem; line-height: 1.5;">
                                                주석을 추가하여 코드 가독성을 높이세요</p>
                                        </div>
                                        <div
                                            style="background: rgba(0,0,0,0.2); border-radius: 12px; padding: 1rem; border: 1px solid rgba(245, 158, 11, 0.1);">
                                            <div style="display: flex; gap: 0.2rem; margin-bottom: 0.5rem;">
                                                <i data-lucide="star"
                                                    style="width: 14px; height: 14px; fill: #f59e0b; color: #f59e0b;"></i>
                                                <i data-lucide="star"
                                                    style="width: 14px; height: 14px; fill: #f59e0b; color: #f59e0b;"></i>
                                            </div>
                                            <p style="margin: 0; color: #fde68a; font-size: 0.85rem; line-height: 1.5;">
                                                매직 넘버를 상수로 정의하세요</p>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>

                        <footer
                            style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); padding: 1.5rem; display: flex; justify-content: space-between; align-items: center;">
                            <div style="display: flex; align-items: center; gap: 1rem;">
                                <div
                                    style="width: 48px; height: 48px; background: rgba(255,255,255,0.2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                    <i data-lucide="check-circle" style="color: white; width: 28px; height: 28px;"></i>
                                </div>
                                <div>
                                    <div style="color: white; font-weight: 700; font-size: 1.1rem;">우수</div>
                                    <div style="color: rgba(255,255,255,0.8); font-size: 0.85rem;">Mid-Senior 레벨 - 실무 투입
                                        가능합니다</div>
                                </div>
                            </div>
                            <button @click="closeCodeModal"
                                style="background: white; color: #6366f1; border: none; padding: 0.8rem 2rem; border-radius: 10px; font-size: 0.95rem; font-weight: 700; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">완료</button>
                        </footer>
                    </div>
                </div>
            </div>
        </transition>
        <!-- 2026-01-17: 중복 트랜지션 태그 수정 제거 -->

        <!-- Sign Up Success Modal (Antigravity Design) -->
        <transition name="fade">
            <div v-if="isSignUpSuccessOpen" class="modal-overlay">
                <div class="auth-container success-container">
                    <div class="success-icon-wrapper">
                        <i data-lucide="shield-check" class="success-icon"></i>
                    </div>
                    <header class="auth-header">
                        <div class="auth-badge success">ACCESS GRANTED</div>
                        <h2 class="auth-title">Welcome, Engineer [[ signupNickname ]]</h2>
                        <p class="auth-subtitle">아키텍처 훈련센터의 모든 시설에 대한 접근 권한이 승인되었습니다.</p>
                    </header>

                    <div class="success-stats">
                        <div class="stat-item">
                            <span class="stat-label">STATUS</span>
                            <span class="stat-value">ACTIVE</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-label">CLEARANCE</span>
                            <span class="stat-value">LEVEL 1</span>
                        </div>
                    </div>

                    <footer class="auth-footer">
                        <button class="btn btn-primary" @click="closeSuccessModal" style="width: 100%;">
                            훈련소 입장하기
                        </button>
                    </footer>
                </div>
            </div>
        </transition>

        <!-- Pseudo-Code Practice Modal (Unit 6 - Design from Image) -->
        <transition name="fade">
            <div v-if="isPseudoModalOpen" class="modal-overlay pseudo-overlay">
                <div class="pseudo-container">
                    <!-- Top Ribbon -->
                    <header class="pseudo-ribbon">
                        <div class="pseudo-title-box">
                            <i data-lucide="gamepad-2"></i>
                            <span>Pseudo-Code Playground</span>
                        </div>
                        <div class="pseudo-stats-box">
                            <div class="stat-pill yellow">Level 1</div>
                            <div class="stat-pill white">XP: 150</div>
                        </div>
                        <button class="close-pseudo" @click="isPseudoModalOpen = false">&times;</button>
                    </header>

                    <div class="pseudo-main-layout">
                        <!-- Left: Mission Objective Card -->
                        <div class="mission-section">
                            <div class="mission-card">
                                <div class="mission-header">
                                    <h3>Mission Objective</h3>
                                    <span class="difficulty-badge pink">Easy</span>
                                </div>
                                <p class="mission-text">
                                    Create a loop that prints "Hello World" exactly 5 times. Remember to use a counter!
                                </p>
                                <div class="hint-section">
                                    <div class="hint-icon-box">
                                        <i data-lucide="lightbulb" class="hint-icon"></i>
                                    </div>
                                    <div class="hint-progress-bar">
                                        <div class="progress-fill" style="width: 40%;"></div>
                                    </div>
                                    <span class="hint-status">HINT READY!</span>
                                </div>
                            </div>
                            <!-- Mascot Character -->
                            <div class="mascot-robot-box">
                                <div class="mascot-speech">You can do it!</div>
                                <div class="robot-avatar-circle">
                                    <img src="https://antigravity-ai.s3.amazonaws.com/assets/robot_mascot.png"
                                        class="robot-img" onerror="this.src='/static/image/mascot.png'">
                                </div>
                            </div>
                        </div>

                        <!-- Right: Editor & Controls -->
                        <div class="editor-section-pseudo">
                            <div class="pseudo-window">
                                <div class="window-header">
                                    <div class="window-dots">
                                        <span></span><span></span><span></span>
                                    </div>
                                    <span class="filename">main.pseudo</span>
                                </div>
                                <textarea v-model="pseudoCode" class="pseudo-textarea" spellcheck="false"></textarea>
                            </div>

                            <div class="pseudo-controls">
                                <button class="pseudo-btn reset-btn" @click="resetPseudoCode">
                                    <i data-lucide="rotate-ccw"></i> Reset
                                </button>
                                <div style="flex: 1;"></div>
                                <button class="pseudo-btn run-btn" @click="runPseudoCode">
                                    <i data-lucide="play"></i> Run Code
                                </button>
                                <button class="pseudo-btn next-btn" @click="isPseudoModalOpen = false">
                                    Next <i data-lucide="arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </transition>

        <!-- Auth Required Modal (Playground Theme) - 2026-01-17 추가 -->
        <transition name="fade">
            <div v-if="isAuthRequiredModalOpen" class="modal-overlay" @click.self="isAuthRequiredModalOpen = false">
                <div class="auth-container playground-auth-card">
                    <div class="playground-header-icon">
                        <i data-lucide="party-popper" class="bounce-icon"></i>
                    </div>
                    <header class="auth-header">
                        <div class="auth-badge warning">STOP! ACCESS RESTRICTED</div>
                        <h2 class="auth-title">놀이터 입장 전 확인! 🚧</h2>
                        <p class="auth-subtitle">
                            아키텍처 놀이터의 모든 시설을 이용하시려면<br>
                            엔지니어 신원 확인(로그인)이 필요합니다.
                        </p>
                    </header>

                    <div class="playground-perks">
                        <div class="perk-item">
                            <i data-lucide="check-circle" class="perk-icon"></i>
                            <span>모든 훈련 스테이지 오픈</span>
                        </div>
                        <div class="perk-item">
                            <i data-lucide="check-circle" class="perk-icon"></i>
                            <span>단백질 쉐이크 보상 획득</span>
                        </div>
                        <div class="perk-item">
                            <i data-lucide="check-circle" class="perk-icon"></i>
                            <span>실시간 랭킹 시스템 반영</span>
                        </div>
                    </div>

                    <footer class="auth-footer" style="flex-direction: column; gap: 0.8rem; margin-top: 1.5rem;">
                        <button class="btn btn-primary" @click="isAuthRequiredModalOpen = false; handleSignUp()"
                            style="width: 100%; height: 55px; font-size: 1.1rem;">
                            무료로 회원가입하고 입장하기
                        </button>
                        <button class="btn btn-secondary" @click="isAuthRequiredModalOpen = false; handleLogin()"
                            style="width: 100%; border: none;">
                            이미 계정이 있나요? 로그인
                        </button>
                        <button class="btn-text" @click="isAuthRequiredModalOpen = false"
                            style="background: none; border: none; color: var(--text-muted); cursor: pointer; font-size: 0.85rem; margin-top: 0.5rem;">
                            다음에 할게요
                        </button>
                    </footer>
                </div>
            </div>
        </transition>

        <!-- Scroll Attempt Warning Toast - 2026-01-17 추가 -->
        <div v-if="!isLoggedIn" class="scroll-warning-toast" :class="{ show: showScrollHint }">
            <i data-lucide="lock" style="width: 18px; color: #1e293b;"></i>
            <span>잠깐! 🚧 로그인이 필요해요</span>
            <button @click="handleLogin"
                style="background: #1e293b; color: white; border: none; padding: 4px 12px; border-radius: 99px; font-size: 0.75rem; cursor: pointer; margin-left: 5px; font-weight: 700;">로그인하기</button>
        </div>
    </div>

    <!-- 2026-01-17: 캐시 방지 버전 추가 -->
    <script src="{% static 'js/app.js' %}?v=1.3"></script>
</body>

</html>